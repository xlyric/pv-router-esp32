Utilisation du pv routeur 

ce pv routeur fonctionne par analyse du sens du courant en sortie de compteur électrique ( avec une sonde de 30A  non intrusive ) 
il communique de façon autonome avec un dimmer numérique distant ( wifi ) et se charge de la régulation 
ou fait une  remontée MQTT vers un serveur distant qui s'en chargera 

montage à faire conformément à la doc sur le git. 

carte lolin v1.1 : fonctionnelle sans pb
carte lolin V1.2 : l'oled est alimenté par VU et non VI, il faut alimenter l'oled avec VI ( + ) 
carte wemos v1.2 : fonctionnelle sans pb.

*******************
informations clés : 
*******************

/config.json contient les valeurs de démarrages sauvegardées 
/config  contient les valeurs actuelles de fonctionnement 

l'application est configurée pour une résistance de 1000W, il est possible de changer le paramettre dans la config ( web ou fichier config.json ) 


- le mode MQTT est sur le git déconnecté, car si il n'y a pas de serveur MQTT présent sur le réseau lors du démarrage, le routeur reboot. 
- si il ne détecte pas de porteuse, il reboot aussi. ( --> pb d'alimentation externe )  car il ne peux pas se synchroniser

il est possible de changer les paramettres manuellement : avec le lien /get?variable=valeur
par exemple /get?fuse=80  pour mettre la limite de sécurité à 80% du dimmer. 



************* Liste des principales valeurs  ************************
{"hostname":"192.168.1.20", --> IP du serveur Domoticz /jeedom
"port":8080,
"apiKey":"" --> clé api pour jeedom
"UseDomoticz":true, >> on utilise domoticz ? 
"UseJeedom":false,  >> on utilise jeedom ? 
"IDX":"36" --> idx Domoticz
,"otapassword":"",
"sending":true, >> on envoie les infos sur les serveurs

"autonome":true, >> cas ou l'on envoie directement la commande au dimmer
"dimmer":"192.168.1.54", >> ip du dimmer

"dimmerlocal":false, >> dimmer branché directement sur la carte


"delta":50, >> valeur de sigma au dessus de laquel on va réduire la puissance du dimmer ( tirage linky )
"deltaneg":0, >> valeur de sigma en dessous de laquel on va augmenter la puissance du dimmer ( injection ) 

"cosphi":11, >> décalage entre la bascule de la diode et le passage à 0 du courant lors de l'oscillation 
** si par défaut sigma est négatif, alors il faut rajouter 18 à la valeur actuelle ( ex ici 11 + 18 = 29 ) ( cas où la sonde est branchée à l'enver ) 

"readtime":555  :temps entre chaque mesure ( ne pas toucher ) 
,"cycle":72, : nombre de mesures faites pour le mode oscillo

"facteur":1.5 : facteur multiplicateur entre la mesure et sigma pour corriger le décallage entre la mesure sur le tableau linky et l'affichage.
"fuse":50 >> fusible numérique qui limite la commande au niveau du dimmer ( ici 50 % max ) 


******************** erreurs courament commises : 

- oublie de sauvegarder la configuration après des modifications et donc retour à la config par défaut au reboot

- pas d'affichage web, mais /config fonctionne :  oublie du téléversement dans l'interface arduino : ( tool - esp8266 sketch data upload )  
ou esptool.py --port com3 --baud 256000 write_flash 0x00200000 spiffs.img 

- dimmer à 50% en permanence et injection : sonde branchée à l 'envers, il faut reconfigurer cosphi sur l'interface et rajouter 18 à la valeur actuelle. 

- diode qui ne s'allume pas : diode soudée à l'envers. 

- Oled qui ne s'allume pas: carte lolin V1.2 l'oled + est branché sur la pin VU et il faut le brancher le + sur la pin VI. 

- activation du MQTT, necessite un reset pour l'enregistrement (/get?reset ) 

